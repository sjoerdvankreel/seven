cmake_policy(SET CMP0091 NEW)
cmake_minimum_required(VERSION 3.21)
project(seven)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_EXTENSIONS OFF)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CONFIGURATION_TYPES "Debug;Release")

find_library(BASE_LIB_Debug base PATHS "${VST_SDK_374_BUILD_DIR}/lib/Debug")
find_library(SDK_LIB_Debug sdk PATHS "${VST_SDK_374_BUILD_DIR}/lib/Debug")
find_library(SDK_COMMON_LIB_Debug sdk_common PATHS "${VST_SDK_374_BUILD_DIR}/lib/Debug")
find_library(PLUGINTERFACES_LIB_Debug pluginterfaces PATHS "${VST_SDK_374_BUILD_DIR}/lib/Debug")
find_library(VSTGUI_LIB_Debug vstgui PATHS "${VST_SDK_374_BUILD_DIR}/lib/Debug")
find_library(VSTGUI_SUPPORT_LIB_Debug vstgui_support PATHS "${VST_SDK_374_BUILD_DIR}/lib/Debug")
find_library(VSTGUI_UIDESCRIPTION_LIB_Debug vstgui_uidescription PATHS "${VST_SDK_374_BUILD_DIR}/lib/Debug")

find_library(BASE_LIB_Release base PATHS "${VST_SDK_374_BUILD_DIR}/lib/Release")
find_library(SDK_LIB_Release sdk PATHS "${VST_SDK_374_BUILD_DIR}/lib/Release")
find_library(SDK_COMMON_LIB_Release sdk_common PATHS "${VST_SDK_374_BUILD_DIR}/lib/Release")
find_library(PLUGINTERFACES_LIB_Release pluginterfaces PATHS "${VST_SDK_374_BUILD_DIR}/lib/Release")
find_library(VSTGUI_LIB_Release vstgui PATHS "${VST_SDK_374_BUILD_DIR}/lib/Release")
find_library(VSTGUI_SUPPORT_LIB_Release vstgui_support PATHS "${VST_SDK_374_BUILD_DIR}/lib/Release")
find_library(VSTGUI_UIDESCRIPTION_LIB_Release vstgui_uidescription PATHS "${VST_SDK_374_BUILD_DIR}/lib/Release")

set(SRC_DIR "src")
file(GLOB_RECURSE SRC "${SRC_DIR}/*.*")
add_library(seven SHARED ${SRC})
set_target_properties(seven PROPERTIES SUFFIX ".vst3")
set_target_properties(seven PROPERTIES DEBUG_POSTFIX ".debug")
set_target_properties(seven PROPERTIES RUNTIME_OUTPUT_DIRECTORY_RELEASE "${CMAKE_BINARY_DIR}/Release/seven.vst3/Contents/x86_64-win")
set_target_properties(seven PROPERTIES RUNTIME_OUTPUT_DIRECTORY_DEBUG "${CMAKE_BINARY_DIR}/Debug/seven.debug.vst3/Contents/x86_64-win")
add_custom_target(copy-resources-release ALL DEPENDS seven COMMAND ${CMAKE_COMMAND} -E copy_directory ${CMAKE_SOURCE_DIR}/src/resource ${CMAKE_BINARY_DIR}/Release/seven.vst3/Contents/Resources)
add_custom_target(copy-resources-debug ALL DEPENDS seven COMMAND ${CMAKE_COMMAND} -E copy_directory ${CMAKE_SOURCE_DIR}/src/resource ${CMAKE_BINARY_DIR}/Debug/seven.debug.vst3/Contents/Resources)

target_include_directories(seven PRIVATE ${VST_SDK_374_SRC_DIR})
target_include_directories(seven PRIVATE ${VST_SDK_374_SRC_DIR}/vstgui4)

target_link_libraries(seven debug "${BASE_LIB_Debug}" optimized "${BASE_LIB_Release}")
target_link_libraries(seven debug "${SDK_LIB_Debug}" optimized "${SDK_LIB_Release}")
target_link_libraries(seven debug "${SDK_COMMON_LIB_Debug}" optimized "${SDK_COMMON_LIB_Release}")
target_link_libraries(seven debug "${PLUGINTERFACES_LIB_Debug}" optimized "${PLUGINTERFACES_LIB_Release}")
target_link_libraries(seven debug "${VSTGUI_LIB_Debug}" optimized "${VSTGUI_LIB_Release}")
target_link_libraries(seven debug "${VSTGUI_SUPPORT_LIB_Debug}" optimized "${VSTGUI_SUPPORT_LIB_Release}")
target_link_libraries(seven debug "${VSTGUI_UIDESCRIPTION_LIB_Debug}" optimized "${VSTGUI_UIDESCRIPTION_LIB_Release}")